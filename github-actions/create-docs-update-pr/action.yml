name: "Generate Embeddings"
description: "Generate Embeddings for documentation in a git repository."

inputs:
  gemini-api-key:
    description: "The Gemini key to use Embeddings"
    required: true
  token:
    description: "The GitHub token to use for authentication."
    required: false
    default: ${{ github.token }}
  docs-path:
    description: "The path to where the docs are located in the repository. Relative to the root of the repository."
    required: true
  embeddings-action:
    description: "The action that generates the docs Embeddings"
    required: true

runs:
  using: "composite"
  steps:
    - name: Get latest workflow run ID
      id: get-run-id
      run: |
        RUN_ID=$(gh api repos/${{ github.repository }}/actions/workflows/${{ inputs.embeddings-action }}/runs \
          --jq '.workflow_runs[] | select(.conclusion == "success") | .id' \
          | head -n 1)
        echo "run_id=$RUN_ID" >> $GITHUB_OUTPUT
      env:
        GH_TOKEN: ${{ inputs.token }}

    - name: Download artifact
      uses: actions/download-artifact@v4
      with:
        name: lapo-embeddings
        run-id: ${{ steps.get-run-id.outputs.run_id }}
        github-token: ${{ inputs.token }}
        path: embeddings

    - name: List files
      run: |
        ls embeddings
      shell: bash
    # - name: "Checkout Repository"
    #   uses: actions/checkout@v3
    #   with:
    #     token: ${{ inputs.token }}
    #     repository: grafana/llm-auto-update-docs
    #     path: llm-auto-update-docs
    #
    # - name: "Checkout Repository"
    #   uses: actions/checkout@v3
    #   with:
    #     token: ${{ inputs.token }}
    #     repository: ${{ github.repository }}
    #     path: target-repo
